
-- Sample MIMIC-III DDL for demonstration
CREATE TABLE IF NOT EXISTS PATIENTS (
    SUBJECT_ID INTEGER PRIMARY KEY,
    GENDER VARCHAR(5),
    DOB DATE,
    DOD DATE,
    DOD_HOSP DATE,
    DOD_SSN DATE,
    EXPIRE_FLAG INTEGER
);

CREATE TABLE IF NOT EXISTS ADMISSIONS (
    SUBJECT_ID INTEGER NOT NULL,
    HADM_ID INTEGER PRIMARY KEY,
    ADMITTIME TIMESTAMP,
    DISCHTIME TIMESTAMP,
    DEATHTIME TIMESTAMP,
    ADMISSION_TYPE VARCHAR(50),
    ADMISSION_LOCATION VARCHAR(50),
    DISCHARGE_LOCATION VARCHAR(50),
    INSURANCE VARCHAR(255),
    LANGUAGE VARCHAR(10),
    RELIGION VARCHAR(50),
    MARITAL_STATUS VARCHAR(50),
    ETHNICITY VARCHAR(200),
    EDREGTIME TIMESTAMP,
    EDOUTTIME TIMESTAMP,
    DIAGNOSIS TEXT,
    HOSPITAL_EXPIRE_FLAG INTEGER,
    HAS_CHARTEVENTS_DATA INTEGER
);

CREATE TABLE IF NOT EXISTS ICUSTAYS (
    ROW_ID INTEGER PRIMARY KEY,
    SUBJECT_ID INTEGER NOT NULL,
    HADM_ID INTEGER,
    ICUSTAY_ID INTEGER,
    DBSOURCE VARCHAR(20),
    FIRST_CAREUNIT VARCHAR(20),
    LAST_CAREUNIT VARCHAR(20),
    FIRST_WARDID INTEGER,
    LAST_WARDID INTEGER,
    INTIME TIMESTAMP,
    OUTTIME TIMESTAMP,
    LOS DECIMAL
);

CREATE TABLE IF NOT EXISTS CHARTEVENTS (
    ROW_ID INTEGER PRIMARY KEY,
    SUBJECT_ID INTEGER NOT NULL,
    HADM_ID INTEGER,
    ICUSTAY_ID INTEGER,
    ITEMID INTEGER,
    CHARTTIME TIMESTAMP,
    STORETIME TIMESTAMP,
    CGID INTEGER,
    VALUE TEXT,
    VALUENUM DECIMAL,
    VALUEUOM VARCHAR(30),
    WARNING INTEGER,
    ERROR INTEGER,
    RESULTSTATUS VARCHAR(50),
    STOPPED VARCHAR(30)
);

CREATE TABLE IF NOT EXISTS LABEVENTS (    
    ROW_ID INTEGER PRIMARY KEY,
    SUBJECT_ID INTEGER NOT NULL,
    HADM_ID INTEGER,
    ITEMID INTEGER,
    CHARTTIME TIMESTAMP,
    VALUE TEXT,
    VALUENUM DECIMAL,
    VALUEUOM VARCHAR(30),
    FLAG VARCHAR(30)
);

CREATE TABLE IF NOT EXISTS DIAGNOSES_ICD (
    ROW_ID INTEGER PRIMARY KEY,
    SUBJECT_ID INTEGER NOT NULL,
    HADM_ID INTEGER,
    SEQ_NUM INTEGER,
    ICD9_CODE VARCHAR(10)
);

CREATE TABLE IF NOT EXISTS PRESCRIPTIONS (
    ROW_ID INTEGER PRIMARY KEY,
    SUBJECT_ID INTEGER NOT NULL,
    HADM_ID INTEGER,
    ICUSTAY_ID INTEGER,
    STARTDATE TIMESTAMP,
    ENDDATE TIMESTAMP,
    DRUG_TYPE VARCHAR(100),
    DRUG VARCHAR(100),
    DRUG_NAME_POE VARCHAR(100),
    DRUG_NAME_GENERIC VARCHAR(100),
    FORMULARY_DRUG_CD VARCHAR(120),
    GSN VARCHAR(200),
    NDC VARCHAR(120),
    PROD_STRENGTH VARCHAR(120),
    DOSE_VAL_RX VARCHAR(120),
    DOSE_UNIT_RX VARCHAR(120),
    FORM_VAL_DISP VARCHAR(120),
    FORM_UNIT_DISP VARCHAR(120),
    ROUTE VARCHAR(120)
);



ALTER TABLE ADMISSIONS
    ADD CONSTRAINT fk_admissions_subject
    FOREIGN KEY (SUBJECT_ID) REFERENCES PATIENTS(SUBJECT_ID);

ALTER TABLE ICUSTAYS
    ADD CONSTRAINT fk_icustays_subject
    FOREIGN KEY (SUBJECT_ID) REFERENCES PATIENTS(SUBJECT_ID);

ALTER TABLE ICUSTAYS
    ADD CONSTRAINT fk_icustays_hadm
    FOREIGN KEY (HADM_ID) REFERENCES ADMISSIONS(HADM_ID);

ALTER TABLE CHARTEVENTS
    ADD CONSTRAINT fk_chartevents_subject
    FOREIGN KEY (SUBJECT_ID) REFERENCES PATIENTS(SUBJECT_ID);

ALTER TABLE CHARTEVENTS
    ADD CONSTRAINT fk_chartevents_hadm
    FOREIGN KEY (HADM_ID) REFERENCES ADMISSIONS(HADM_ID);

ALTER TABLE CHARTEVENTS
    ADD CONSTRAINT fk_chartevents_icustay
    FOREIGN KEY (ICUSTAY_ID) REFERENCES ICUSTAYS(ICUSTAY_ID);

ALTER TABLE LABEVENTS
    ADD CONSTRAINT fk_labevents_subject
    FOREIGN KEY (SUBJECT_ID) REFERENCES PATIENTS(SUBJECT_ID);

ALTER TABLE LABEVENTS
    ADD CONSTRAINT fk_labevents_hadm
    FOREIGN KEY (HADM_ID) REFERENCES ADMISSIONS(HADM_ID);

ALTER TABLE DIAGNOSES_ICD
    ADD CONSTRAINT fk_diagnoses_subject
    FOREIGN KEY (SUBJECT_ID) REFERENCES PATIENTS(SUBJECT_ID);

ALTER TABLE DIAGNOSES_ICD
    ADD CONSTRAINT fk_diagnoses_hadm
    FOREIGN KEY (HADM_ID) REFERENCES ADMISSIONS(HADM_ID);

ALTER TABLE PRESCRIPTIONS
    ADD CONSTRAINT fk_prescriptions_subject
    FOREIGN KEY (SUBJECT_ID) REFERENCES PATIENTS(SUBJECT_ID);

ALTER TABLE PRESCRIPTIONS
    ADD CONSTRAINT fk_prescriptions_hadm
    FOREIGN KEY (HADM_ID) REFERENCES ADMISSIONS(HADM_ID);

ALTER TABLE PRESCRIPTIONS
    ADD CONSTRAINT fk_prescriptions_icustay
    FOREIGN KEY (ICUSTAY_ID) REFERENCES ICUSTAYS(ICUSTAY_ID);
